---
permalink: /:categories/:year/:month/:title.html
layout: post
title: Simple Spring AOP and annotations example
date: '2010-04-15T15:12:00.000-07:00'
author: Andres Olarte
tags:
- aop
- spring
- java
modified_time: '2010-04-29T15:37:42.734-07:00'
blogger_id: tag:blogger.com,1999:blog-3306197464901287625.post-1139297784060030442
blogger_orig_url: http://www.javaprocess.com/2010/04/simple-spring-aop-and-annotations.html
---

Spring seems to be the tool of choice for many new web projects nowadays, and while there's a wealth of examples and documentation out there, one particular use case eluded me quite a bit: AOP with annotations.  I don't like xml, I prefer annotations and convections, so here's a step by step example on how to get a basic example up and running.  In this very basic example we'll create a logging aspect and wrap it around an object.<br /><br />First let's get everything setup.  We'll start with an empty webproject, and we'll add the following libraries:<br /><ul><br /><li>All of the jars from the spring-framework-3.0.1 zip. (from http://springsource.org)</li><br /><li>asm3.2.jar (from http://asm.ow2.org/)</li><br /><li>aspectjrt.jar and aspectjweaver.jar (from /http://www.eclipse.org/aspectj/downloads.php, in this example I'm using aspectj-1.6.8.jar.  The jars you need are inside the jar you download)</li><br /><li>cglib-2.2.jar (from http://cglib.sourceforge.net/)</li><br /><li>com.springsource.org.aopalliance-1.0.0.jar (from http://repository.springsource.com/ivy/bundles/external/org.aopalliance/com.springsource.org.aopalliance/1.0.0/com.springsource.org.aopalliance-1.0.0.jar)</li><br /><li>commons-logging-1.1.1.jar (from http://commons.apache.org/)</li><br /><li>jstl-api-1.2.jar and jstl-impl-1.2.jar(https://jstl.dev.java.net/download.html, maybe not required, but always useful)</li><br /></ul><br />Now let's create a basic web.xml:<br /><br /><pre class="brush: xml"><br />&lt;web-app xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" schemalocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" id="WebApp_ID" version="2.5"&gt;<br />&lt;display-name&gt;spring.test&lt;/display-name&gt;<br />&lt;welcome-file-list&gt;<br />&lt;welcome-file&gt;index.html&lt;/welcome-file&gt;<br />&lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;<br />&lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;<br />&lt;welcome-file&gt;default.html&lt;/welcome-file&gt;<br />&lt;welcome-file&gt;default.htm&lt;/welcome-file&gt;<br />&lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt;<br />&lt;/welcome-file-list&gt;<br /><br />&lt;listener&gt;<br />&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;<br />&lt;/listener&gt;<br />&lt;context-param&gt;<br />&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;<br />&lt;param-value&gt;<br />        /WEB-INF/spring/web-application-context.xml<br />    &lt;/param-value&gt;<br />&lt;/context-param&gt;<br /><br />&lt;filter&gt;<br />&lt;filter-name&gt;encoding-filter&lt;/filter-name&gt;<br />&lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;<br />&lt;init-param&gt;<br /> &lt;param-name&gt;encoding&lt;/param-name&gt;<br /> &lt;param-value&gt;UTF-8&lt;/param-value&gt;<br />&lt;/init-param&gt;<br />&lt;/filter&gt;<br /><br /><br />&lt;filter-mapping&gt;<br />&lt;filter-name&gt;encoding-filter&lt;/filter-name&gt;<br />&lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br /><br />&lt;servlet&gt;<br />&lt;servlet-name&gt;simple-form&lt;/servlet-name&gt;<br />&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;<br />&lt;init-param&gt;<br /> &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;<br /> &lt;param-value&gt;&lt;/param-value&gt;<br />&lt;/init-param&gt;<br />&lt;/servlet&gt;<br /><br /><br />&lt;servlet-mapping&gt;<br />&lt;servlet-name&gt;simple-form&lt;/servlet-name&gt;<br />&lt;url-pattern&gt;*.do&lt;/url-pattern&gt;<br />&lt;/servlet-mapping&gt;<br />&lt;/web-app&gt;<br /></pre><br /><br />The xml simple initializes the spring framework, by passing the location of the main configuration file ( /WEB-INF/spring/web-application-context.xml ).  We also map our spring actions to *.do.  Now let's look at the web-application-context file:<br /><br /><pre class="brush: xml"><br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;beans xmlns="http://www.springframework.org/schema/beans"<br /> xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br /> xmlns:context="http://www.springframework.org/schema/context"<br /> xsi:schemaLocation="http://www.springframework.org/schema/beans<br />                        http://www.springframework.org/schema/beans/spring-beans.xsd<br />                        http://www.springframework.org/schema/context<br />                        http://www.springframework.org/schema/context/spring-context.xsd"&gt;<br /><br /> &lt;context:component-scan base-package="test.spring.actions" /&gt;<br /><br /> &lt;!-- Imports the configurations of the different infrastructure systems of the application --&gt;<br /> &lt;import resource="webmvc-context.xml" /&gt;<br /> &lt;import resource="aop-context.xml"/&gt;<br />&lt;/beans&gt;<br /></pre><br /><br />This file is only defining which package should be scanned for packages (test.spring.actions) and importing two further files.  One of these files controls the AOP part of the framework, while the other control the MVC (Model-View-Controller) part of the framework.  Let's look at the aop-context file:<br /><br /><pre class="brush: xml"><br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;beans xmlns="http://www.springframework.org/schema/beans"<br />  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />  xmlns:aop="http://www.springframework.org/schema/aop"<br />  xsi:schemaLocation="<br />http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd<br />http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd"&gt;<br /><br />&lt;aop:aspectj-autoproxy /&gt;<br /><br />&lt;bean id="myAspect" class="test.spring.aspects.Logger"/&gt;<br />&lt;bean id="myAspectLog" class="test.spring.actions.LogObject"/&gt;<br />&lt;/beans&gt;<br /></pre><br /><br />Of note here, is the aspectj-autoproxy tag, which is required to enable the creation of proxy object to apply the aspects.  Now, lets look at the code.  The first up is the logger aspect that we will be applying to one or more classes:<br /><pre class="brush: java"><br />package test.spring.aspects;<br /><br />import org.aspectj.lang.ProceedingJoinPoint;<br />import org.aspectj.lang.annotation.Around;<br />import org.aspectj.lang.annotation.Aspect;<br /><br />@Aspect<br />public class Logger {<br /><br /><br />@Around(("execution(* test.spring.actions.LogObject.*(..))"))<br />public Object cache(ProceedingJoinPoint pjp) {<br />System.out.println("Entering: " + pjp.getSignature().getDeclaringTypeName());<br />Object ret=null;<br />try {<br /> ret = pjp.proceed();<br />} catch (Throwable e) {<br /><br />}<br />System.out.println("Leaving: " + pjp.getSignature().getDeclaringTypeName());<br />return ret;<br />}<br />} </pre><br /><br />Here we're using the @Around annotation to declare an around join point, since this type gives us more information regarding the class and method we're wrapping.  In the same annotation, we also specify that this point cut should be applied to all method of the LogObject class.  This is the point cut expression, and it fairly flexible.  More information can be found elsewhere in the web, including the Spring <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/aop.html#aop-pointcuts-examples">documentation</a>.  Other than this, our aspect just logs the entry and exit of the methods.<br /><br />The actual class we're applying the aspect to is rather uninteresting:<br /><br /><pre class="brush: java"><br />package test.spring.actions;<br /><br />public class LogObject implements ILogObject{<br /><br />@Override<br />public String view() {<br /><br />return "";<br />}<br /><br />}<br /></pre><br /><br />Of course this is where you're actual application logic would live, but the purpose here is to provide the simplest example possible.  The only notable aspect of this class is that it implements an interface.  In our controller we'll use the interface instead of the actual implementation, since what Spring will wire for us is actually a dynamic proxy of the real object.  In any case, it is normally good practice to program against interfaces.<br /><br />Last is our  controller, where we tie everything together:<br /><pre class="brush: java"><br />package test.spring.actions;<br /><br />import org.springframework.beans.factory.annotation.Autowired;<br />import org.springframework.stereotype.Controller;<br />import org.springframework.web.bind.annotation.RequestMapping;<br /><br />@Controller<br />@RequestMapping("/test")<br />public class TestAction {<br /><br />@Autowired<br />ILogObject l;<br />@RequestMapping<br />public String view () {<br />l.view();<br />return "test";<br />}<br />}<br /><br /></pre><br /><br />The controller is letting Spring autowire the ILogObject, which will be proxied to provide the functionality provided by our logging aspect.  So, go ahead and hit the action from your browser, in the console you will see the log messages before and after we execute the view() method.<br /><br />So this is it, I hope this helps people as a basic starting point for using AOP inside spring, without having to write too much xml.
